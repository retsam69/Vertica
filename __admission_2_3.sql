DROP TABLE st4hdc.ADMISSION;

CREATE TABLE st4hdc.ADMISSION
(
    HOSPCODE varchar(5) NOT NULL,
    PID varchar(15) NOT NULL,
    SEQ varchar(16) NOT NULL,
    AN varchar(9) NOT NULL,
    DATETIME_ADMIT timestamp NOT NULL,
    WARDADMIT varchar(5) NOT NULL,
    INSTYPE varchar(4) NOT NULL,
    TYPEIN varchar(1) NOT NULL,
    REFERINHOSP varchar(5),
    CAUSEIN varchar(1),
    ADMITWEIGHT numeric(5,1),
    ADMITHEIGHT numeric(3,0),
    DATETIME_DISCH timestamp NOT NULL,
    WARDDISCH varchar(5) NOT NULL,
    DISCHSTATUS varchar(1) NOT NULL,
    DISCHTYPE varchar(1) NOT NULL,
    REFEROUTHOSP varchar(5),
    CAUSEOUT varchar(1),
    COST numeric(11,2),
    PRICE numeric(11,2) NOT NULL,
    PAYPRICE numeric(11,2) NOT NULL,
    ACTUALPAY numeric(11,2) NOT NULL,
    PROVIDER varchar(15),
    D_UPDATE timestamp NOT NULL,
    DRG varchar(5),
    RW numeric(11,4),
    ADJRW numeric(11,4),
    ERROR varchar(2),
    WARNING varchar(4),
    ACTLOS numeric(4,0),
    GROUPER_VERSION varchar(20),
    CID varchar(13),
    HDC_DATE timestamp,
    SOURCE_DATA varchar(6)
);

ALTER TABLE st4hdc.ADMISSION ADD CONSTRAINT ADMISSION_PK PRIMARY KEY (HOSPCODE, PID, AN, DATETIME_ADMIT) ENABLED;


CREATE PROJECTION st4hdc.ADMISSION /*+createtype(A)*/ 
(
 HOSPCODE,
 PID,
 SEQ,
 AN,
 DATETIME_ADMIT,
 WARDADMIT,
 INSTYPE,
 TYPEIN,
 REFERINHOSP,
 CAUSEIN,
 ADMITWEIGHT,
 ADMITHEIGHT,
 DATETIME_DISCH,
 WARDDISCH,
 DISCHSTATUS,
 DISCHTYPE,
 REFEROUTHOSP,
 CAUSEOUT,
 COST,
 PRICE,
 PAYPRICE,
 ACTUALPAY,
 PROVIDER,
 D_UPDATE,
 DRG,
 RW,
 ADJRW,
 ERROR,
 WARNING,
 ACTLOS,
 GROUPER_VERSION,
 CID,
 HDC_DATE,
 SOURCE_DATA
)
AS
 SELECT ADMISSION.HOSPCODE,
        ADMISSION.PID,
        ADMISSION.SEQ,
        ADMISSION.AN,
        ADMISSION.DATETIME_ADMIT,
        ADMISSION.WARDADMIT,
        ADMISSION.INSTYPE,
        ADMISSION.TYPEIN,
        ADMISSION.REFERINHOSP,
        ADMISSION.CAUSEIN,
        ADMISSION.ADMITWEIGHT,
        ADMISSION.ADMITHEIGHT,
        ADMISSION.DATETIME_DISCH,
        ADMISSION.WARDDISCH,
        ADMISSION.DISCHSTATUS,
        ADMISSION.DISCHTYPE,
        ADMISSION.REFEROUTHOSP,
        ADMISSION.CAUSEOUT,
        ADMISSION.COST,
        ADMISSION.PRICE,
        ADMISSION.PAYPRICE,
        ADMISSION.ACTUALPAY,
        ADMISSION.PROVIDER,
        ADMISSION.D_UPDATE,
        ADMISSION.DRG,
        ADMISSION.RW,
        ADMISSION.ADJRW,
        ADMISSION.ERROR,
        ADMISSION.WARNING,
        ADMISSION.ACTLOS,
        ADMISSION.GROUPER_VERSION,
        ADMISSION.CID,
        ADMISSION.HDC_DATE,
        ADMISSION.SOURCE_DATA
 FROM st4hdc.ADMISSION
 ORDER BY ADMISSION.HOSPCODE,
          ADMISSION.PID,
          ADMISSION.AN,
          ADMISSION.DATETIME_ADMIT
SEGMENTED BY hash(ADMISSION.HOSPCODE, ADMISSION.PID, ADMISSION.AN, ADMISSION.DATETIME_ADMIT) ALL NODES KSAFE 1;

--SELECT MARK_DESIGN_KSAFE(1);
