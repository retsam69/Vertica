DROP TABLE st4hdc.REFER_RESULT;

CREATE TABLE st4hdc.REFER_RESULT
(
    HOSPCODE varchar(5) NOT NULL,
    REFERID_SOURCE varchar(10) NOT NULL,
    REFERID_PROVINCE varchar(10),
    HOSP_SOURCE varchar(5) NOT NULL,
    REFER_RESULT varchar(1) NOT NULL,
    DATETIME_IN timestamp,
    PID_IN varchar(15),
    AN_IN varchar(9),
    REASON varchar(255),
    D_UPDATE timestamp NOT NULL,
    HDC_DATE timestamp,
    SOURCE_DATA varchar(6)
);

ALTER TABLE st4hdc.REFER_RESULT ADD CONSTRAINT REFER_RESULT_PK PRIMARY KEY (HOSPCODE, REFERID_SOURCE, HOSP_SOURCE) ENABLED;

CREATE PROJECTION st4hdc.REFER_RESULT /*+createtype(A)*/ 
(
 HOSPCODE,
 REFERID_SOURCE,
 REFERID_PROVINCE,
 HOSP_SOURCE,
 REFER_RESULT,
 DATETIME_IN,
 PID_IN,
 AN_IN,
 REASON,
 D_UPDATE,
 HDC_DATE,
 SOURCE_DATA
)
AS
 SELECT REFER_RESULT.HOSPCODE,
        REFER_RESULT.REFERID_SOURCE,
        REFER_RESULT.REFERID_PROVINCE,
        REFER_RESULT.HOSP_SOURCE,
        REFER_RESULT.REFER_RESULT,
        REFER_RESULT.DATETIME_IN,
        REFER_RESULT.PID_IN,
        REFER_RESULT.AN_IN,
        REFER_RESULT.REASON,
        REFER_RESULT.D_UPDATE,
        REFER_RESULT.HDC_DATE,
        REFER_RESULT.SOURCE_DATA
 FROM st4hdc.REFER_RESULT
 ORDER BY REFER_RESULT.HOSPCODE,
          REFER_RESULT.REFERID_SOURCE,
          REFER_RESULT.HOSP_SOURCE
SEGMENTED BY hash(REFER_RESULT.HOSPCODE, REFER_RESULT.REFERID_SOURCE, REFER_RESULT.HOSP_SOURCE) ALL NODES KSAFE 1;

--SELECT MARK_DESIGN_KSAFE(1);
